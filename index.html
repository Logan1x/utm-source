<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WhatsApp UTM Link</title>
    <meta name="description" content="Paste a URL → auto-copy link with ?utm_source=whatsapp&utm_medium=status" />
    <style>
      :root {
        --bg: #0b0b0c;
        --panel: rgba(255, 255, 255, 0.06);
        --border: rgba(255, 255, 255, 0.12);
        --text: rgba(255, 255, 255, 0.92);
        --muted: rgba(255, 255, 255, 0.62);
        --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono",
          "Courier New", monospace;
        --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        font-family: var(--sans);
        background: radial-gradient(900px 500px at 20% -10%, rgba(255, 255, 255, 0.08), transparent),
          radial-gradient(700px 400px at 90% 10%, rgba(255, 255, 255, 0.06), transparent),
          var(--bg);
        color: var(--text);
        /* Prevent accidental scroll on mobile */
        overflow: hidden;
      }
      .wrap {
        width: 100%;
        max-width: none;
        margin: 0;
        padding: 44px 16px 20px;
        height: var(--vvh, 100svh);
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
      }

      /* When the keyboard is open, stop bottom-aligning so inputs don't get covered */
      body.keyboard-open .wrap {
        justify-content: flex-start;
        padding-top: 24px;
      }

      @media (min-width: 900px) {
        .wrap {
          padding: 64px 24px 32px;
        }
      }
      h1 {
        margin: 0;
        font-size: 18px;
        letter-spacing: -0.02em;
      }
      .sub {
        margin: 6px 0 0;
        font-size: 13px;
        color: var(--muted);
        line-height: 1.45;
      }

      /* On mobile, keep the UI reachable (bottom aligned via .wrap). */
      @media (max-width: 720px) {
        .sub {
          margin-bottom: 12px;
        }
      }

      .card {
        margin-top: 18px;
        border: 1px solid var(--border);
        background: var(--panel);
        border-radius: 10px;
        padding: 14px;
        width: 100%;
      }

      .topActions {
        display: flex;
        justify-content: flex-end;
        margin-top: 10px;
      }

      .btnPaste {
        border-radius: 10px;
        padding: 10px 14px;
        background: rgba(255, 255, 255, 0.06);
      }

      /* Make submit (arrow) button more "white" */
      #btnGo {
        background: rgba(255, 255, 255, 0.18);
      }
      #btnGo:hover {
        background: rgba(255, 255, 255, 0.22);
      }
      .inputRow {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 10px;
        align-items: stretch;
      }
      textarea {
        width: 100%;
        border: 1px solid var(--border);
        background: rgba(0, 0, 0, 0.18);
        border-radius: 10px;
        padding: 16px 14px;
        color: var(--text);
        outline: none;
        font-family: var(--mono);
        font-size: 14px;
        line-height: 1.35;
        min-height: 58px;
        /* Resizing can introduce scroll; keep layout stable */
        resize: none;
      }
      textarea:focus {
        border-color: rgba(255, 255, 255, 0.22);
        box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.06);
      }
      button {
        border: 1px solid var(--border);
        background: rgba(255, 255, 255, 0.10);
        color: var(--text);
        border-radius: 10px;
        padding: 10px 16px;
        font-size: 14px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      #btnGo {
        padding: 0 16px;
        min-width: 54px;
      }
      button:hover { background: rgba(255, 255, 255, 0.14); }
      button:disabled { opacity: 0.55; cursor: not-allowed; }
      .icon {
        width: 18px;
        height: 18px;
        display: inline-block;
      }
      .status {
        margin-top: 12px;
        font-size: 13px;
        color: var(--muted);
        line-height: 1.4;
      }
      .status.error { color: rgba(255, 170, 170, 0.92); }
      .actions {
        margin-top: 12px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .btnSecondary {
        background: rgba(255, 255, 255, 0.06);
      }
      .footer {
        margin-top: 18px;
        font-size: 12px;
        color: var(--muted);
      }
      a { color: inherit; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div>
        <h1>WhatsApp UTM Link</h1>
        <p class="sub">Paste a link. Tap the arrow. We’ll auto-copy a version with <span style="font-family:var(--mono)">utm_source=whatsapp</span> and <span style="font-family:var(--mono)">utm_medium=status</span>.</p>
      </div>

      <div class="card">
        <div class="topActions">
          <button class="btnSecondary btnPaste" id="btnPaste" type="button" title="Paste whatever is in your clipboard">
            Paste what’s copied
          </button>
        </div>

        <div class="inputRow">
          <textarea id="inputUrl" placeholder="Paste link here…"></textarea>
          <button id="btnGo" title="Build + copy">
            <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M5 12h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M13 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>

        <div class="actions">
          <button class="btnSecondary" id="btnShare" disabled title="Share to WhatsApp">
            <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden>
              <path d="M8 12h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M12 8l4 4-4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Share to WhatsApp
          </button>
          <button class="btnSecondary" id="btnClear" title="Clear">
            <svg class="icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden>
              <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Clear
          </button>
        </div>

        <div class="status" id="status"></div>
        <div class="footer">This page only edits the URL. It does not store anything.</div>
      </div>
    </div>

    <script>
      const elIn = document.getElementById('inputUrl')
      const elStatus = document.getElementById('status')
      const btnGo = document.getElementById('btnGo')
      const btnShare = document.getElementById('btnShare')
      const btnClear = document.getElementById('btnClear')
      const btnPaste = document.getElementById('btnPaste')

      let lastOut = ''

      // Mobile keyboard handling: keep layout within visual viewport
      function updateViewportHeight() {
        const vv = window.visualViewport
        if (!vv) return
        document.documentElement.style.setProperty('--vvh', `${vv.height}px`)
      }
      if (window.visualViewport) {
        updateViewportHeight()
        window.visualViewport.addEventListener('resize', updateViewportHeight)
        window.visualViewport.addEventListener('scroll', updateViewportHeight)
      }

      elIn.addEventListener('focus', () => {
        document.body.classList.add('keyboard-open')
        // ensure visible
        setTimeout(() => elIn.scrollIntoView({ block: 'center', behavior: 'smooth' }), 50)
      })
      elIn.addEventListener('blur', () => {
        // small delay so clicks on buttons don't flicker
        setTimeout(() => document.body.classList.remove('keyboard-open'), 150)
      })

      async function onPaste() {
        try {
          const text = await navigator.clipboard.readText()
          if (!text?.trim()) {
            setStatus('Clipboard is empty', 'error')
            return
          }
          elIn.value = text
          setStatus('Pasted')
          // Optional: build immediately after paste
          // onGo()
        } catch {
          setStatus('Paste not allowed by browser. Long-press in the input and paste.', 'error')
        }
      }

      btnPaste.addEventListener('click', onPaste)

      function setStatus(msg, kind = 'info') {
        elStatus.textContent = msg || ''
        elStatus.className = 'status' + (kind === 'error' ? ' error' : '')
      }

      function buildUrl(raw) {
        const trimmed = String(raw || '').trim()
        if (!trimmed) throw new Error('Paste a link first')

        let u
        try {
          u = new URL(trimmed)
        } catch {
          u = new URL('https://' + trimmed)
        }

        u.searchParams.set('utm_source', 'whatsapp')
        u.searchParams.set('utm_medium', 'status')
        return u.toString()
      }

      async function copyToClipboard(text) {
        try {
          await navigator.clipboard.writeText(text)
          return true
        } catch {
          try {
            const tmp = document.createElement('textarea')
            tmp.value = text
            tmp.style.position = 'fixed'
            tmp.style.left = '-9999px'
            document.body.appendChild(tmp)
            tmp.focus()
            tmp.select()
            const ok = document.execCommand('copy')
            document.body.removeChild(tmp)
            return ok
          } catch {
            return false
          }
        }
      }

      async function onGo() {
        try {
          const out = buildUrl(elIn.value)
          lastOut = out
          const copied = await copyToClipboard(out)
          btnShare.disabled = false

          if (copied) setStatus('Copied. Now tap “Share to WhatsApp”.')
          else setStatus('Link created. Copy it manually from the address bar.', 'error')

          // Open share panel when available
          if (navigator.share) {
            // Show native share sheet (browser share panel)
            try {
              await navigator.share({ title: 'WhatsApp link', url: out })
            } catch {
              // user cancelled; that's fine
            }
          }
        } catch (e) {
          lastOut = ''
          btnShare.disabled = true
          setStatus(e?.message || 'Invalid link', 'error')
        }
      }

      function onShare() {
        if (!lastOut) return
        // WhatsApp deep link (works on mobile; on desktop opens web.whatsapp)
        const wa = `https://wa.me/?text=${encodeURIComponent(lastOut)}`
        window.open(wa, '_blank', 'noopener,noreferrer')
      }

      function onClear() {
        elIn.value = ''
        lastOut = ''
        btnShare.disabled = true
        setStatus('')
        elIn.focus()
      }

      btnGo.addEventListener('click', onGo)
      btnShare.addEventListener('click', onShare)
      btnClear.addEventListener('click', onClear)

      // convenience: Enter builds, Ctrl/Cmd+Enter builds
      elIn.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault()
          onGo()
        }
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
          e.preventDefault()
          onGo()
        }
      })
    </script>
  </body>
</html>
